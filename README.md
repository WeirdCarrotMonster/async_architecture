![Асинхронная архитектура(3)](https://user-images.githubusercontent.com/935751/191914482-ec43d07c-f326-4179-950a-3b7ccd6c499d.jpg)

# Сервисы

## frontend

Веб-интерфейс системы. Отвечает за хранение сессий пользователей, но для авторизации выполняет запросы в `auth_service`.
Показывает нужные дашборды пользователям с подходящими ролями, используя в качестве источника данных `backend`.

## auth_service

Сервис базы пользователей. Отвечает за авторизацию пользователей, предоставляет простой REST-интерфейс к базе.

## backend

Монолит. Обрабатывает всю бизнес логику.

## Коммуникация между сервисами

Полностью синхронная. Пример — `frontend` проверяет роль пользователя (i.e. `admin`) и запрашивает с бека данные для дашборда аналитики.
Проверка роли пользователя выполняется через запрос к `auth_service` (ID авторизацонного пользователя лежит в данных сессии).

`auth_service` выполняет аутентификацию, получая "форму клюва" и возвращая подходящего пользователя (id, роль, "форма клюва"). Так же доступны методы
получения случайного пользователя и пользователя по ID.

Запросы в `backend` уходят без авторизационных данных — за отображение нужной информации нужным пользователям отвечает только `frontend`. Методы
бекенда явно описывают необходимость передачи ID пользователя (информация о собственном счете), либо её отсутствие (аккаунтинг для администраторов и
бухгалтеров)

# Что делать, если что-то падает

## frontend

Ничего, система недоступна. Будет работать рассылка писем, т.к. она обрабатывается в монолите, но в остальном всё плохо.

## auth_service

В описанной схеме - всё так же плохо, система будет недоступна. Можно добавить кеширование части данных на `frontend`'е — например, роли пользователя
или пользовательских данных в целом, но будет возникать вопрос инвалидации кеша, если пользователя редактировали. В требованиях к сервису не описано,
может ли меняться роль пользователя.

Если предположить, что роль не меняется и её можно безопасно хранить в сессии, то падение `auth_service` сломает логин неавторизованных пользователей и 
часть функционала бекенда ("заассайнить задачи" по кнопке), но в остальном система будет работоспособна.

## backend

Никакой функционал, кроме авторизации, не будет доступен.

# Спорные места

1. Кажется, будто бы топ-менеджмент описывает все фичи (таск-трекер, аккаунтинг и аналитика) как отдельные сервисы. В них упоминается, что авторизация 
выполняется через общий сервис. Не подразумевается ли то, что в каждый сервис нужно логиниться отдельно и явно?
2. Неясно, как именно топ-менеджмент видит отдельный сервис авторизации. Используется ли он в других проектах, за пределами трекера задач? Нужно ли
будет его дополнять SSO и прочим функционалом?
